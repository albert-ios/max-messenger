"use strict";
exports.ids = [
    "274"
];
exports.modules = {
    "./src/utils/profile.ts" (__unused_webpack_module, __webpack_exports__, __webpack_require__) {
        __webpack_require__.d(__webpack_exports__, {
            applyProfile: ()=>applyProfile
        });
        var node_fs__rspack_import_0 = __webpack_require__("node:fs");
        var node_fs__rspack_import_0_default = /*#__PURE__*/ __webpack_require__.n(node_fs__rspack_import_0);
        var node_path__rspack_import_1 = __webpack_require__("node:path");
        var node_path__rspack_import_1_default = /*#__PURE__*/ __webpack_require__.n(node_path__rspack_import_1);
        var _rspackCore__rspack_import_2 = __webpack_require__("./src/utils/rspackCore.ts");
        const DEFAULT_RUST_TRACE_LAYER = "perfetto";
        async function applyProfile(filterValue, traceLayer = DEFAULT_RUST_TRACE_LAYER, traceOutput) {
            const { asyncExitHook } = await import("exit-hook");
            if ("logger" !== traceLayer && "perfetto" !== traceLayer) throw new Error(`unsupported trace layer: ${traceLayer}`);
            const timestamp = Date.now();
            const defaultOutputDir = node_path__rspack_import_1_default().resolve(`.rspack-profile-${timestamp}-${process.pid}`);
            if (traceOutput) {
                if ("stdout" !== traceOutput && "stderr" !== traceOutput) traceOutput = node_path__rspack_import_1_default().resolve(defaultOutputDir, traceOutput);
            } else {
                const defaultRustTracePerfettoOutput = node_path__rspack_import_1_default().resolve(defaultOutputDir, "rspack.pftrace");
                const defaultRustTraceLoggerOutput = "stdout";
                const defaultTraceOutput = "perfetto" === traceLayer ? defaultRustTracePerfettoOutput : defaultRustTraceLoggerOutput;
                traceOutput = defaultTraceOutput;
            }
            await ensureFileDir(traceOutput);
            await _rspackCore__rspack_import_2.Z.experiments.globalTrace.register(filterValue, traceLayer, traceOutput);
            asyncExitHook(_rspackCore__rspack_import_2.Z.experiments.globalTrace.cleanup, {
                wait: 500
            });
        }
        async function ensureFileDir(outputFilePath) {
            const dir = node_path__rspack_import_1_default().dirname(outputFilePath);
            await node_fs__rspack_import_0_default().promises.mkdir(dir, {
                recursive: true
            });
        }
    }
};
